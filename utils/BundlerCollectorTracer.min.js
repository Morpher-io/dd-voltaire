{numberLevels:[],currentLevel:null,keccak:[],calls:[],logs:[],debug:[],lastOp:"",numberCounter:0,fault:function fault(a,b){this.debug.push("fault depth="+a.getDepth()+" gas="+a.getGas()+" cost="+a.getCost()+" err="+a.getError())},result:function result(a,b){return{numberLevels:this.numberLevels,keccak:this.keccak,logs:this.logs,calls:this.calls,debug:this.debug,}},enter:function enter(a){this.debug.push("enter gas="+a.getGas()+" type="+a.getType()+" to="+toHex(a.getTo())+" in="+toHex(a.getInput()).slice(0,500));this.calls.push({type:a.getType(),from:toHex(a.getFrom()),to:toHex(a.getTo()),method:toHex(a.getInput()).slice(0,10),gas:a.getGas(),value:a.getValue(),})},exit:function exit(a){this.calls.push({type:a.getError()!=null?"REVERT":"RETURN",gasUsed:a.getGasUsed(),data:toHex(a.getOutput()).slice(0,1000),})},countSlot:function countSlot(a,b){if(!a[b])a[b]=0;a[b]+=1},step:function step(a,b){var c=a.op.toString();if(a.getGas()<a.getCost()){this.currentLevel.oog=true}if(c==="REVERT"||c==="RETURN"){if(a.getDepth()===1){var d=parseInt(a.stack.peek(0).toString());var e=parseInt(a.stack.peek(1).toString());var f=toHex(a.memory.slice(d,d+e)).slice(0,1000);this.debug.push(c+" "+f);this.calls.push({type:c,gasUsed:0,data:f,})}}if(c.match(/^(EXT.*|CALL|CALLCODE|DELEGATECALL|STATICCALL)$/)!=null){var g=c.startsWith("EXT")?0:1;var h=toAddress(a.stack.peek(g).toString(16));var j=toHex(h);var k=(k=this.currentLevel.contractSize[j])!==null&&k!==void 0?k:0;if(k===0&&!isPrecompiled(h)){this.currentLevel.contractSize[j]=b.getCode(h).length}}if(a.getDepth()===1){if(c==="NUMBER")this.numberCounter++;if(this.numberLevels[this.numberCounter]==null){this.currentLevel=this.numberLevels[this.numberCounter]={access:{},opcodes:{},contractSize:{},}}this.lastOp="";return}if(this.lastOp==="GAS"&&!c.includes("CALL")){this.countSlot(this.currentLevel.opcodes,"GAS")}if(c!=="GAS"){if(c.match(/^(DUP\d+|PUSH\d+|SWAP\d+|POP|ADD|SUB|MUL|DIV|EQ|LTE?|S?GTE?|SLT|SH[LR]|AND|OR|NOT|ISZERO)$/)==null){this.countSlot(this.currentLevel.opcodes,c)}}this.lastOp=c;if(c==="SLOAD"||c==="SSTORE"){var l=a.stack.peek(0).toString(16);var m=toHex(a.contract.getAddress());var n=void 0;if((n=this.currentLevel.access[m])==null){this.currentLevel.access[m]=n={reads:{},writes:{},}}this.countSlot(c==="SLOAD"?n.reads:n.writes,l)}if(c==="KECCAK256"){var o=parseInt(a.stack.peek(0).toString());var p=parseInt(a.stack.peek(1).toString());if(p>20&&p<512){this.keccak.push(toHex(a.memory.slice(o,o+p)))}}else if(c.startsWith("LOG")){var q=parseInt(c.substring(3));var r=parseInt(a.stack.peek(0).toString());var s=parseInt(a.stack.peek(1).toString());var t=[];for(var i=0;i<q;i++){t.push("0x"+a.stack.peek(2+i).toString(16))}var u=toHex(a.memory.slice(r,r+s));this.logs.push({topics:t,data:u,})}},}